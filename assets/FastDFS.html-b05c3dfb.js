import{_ as p,r as c,o as i,c as o,a as n,b as a,d as e,e as t}from"./app-f078eaf8.js";const l={},r={class:"custom-container tip"},u=n("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},[n("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[n("circle",{cx:"12",cy:"12",r:"9"}),n("path",{d:"M12 8h.01"}),n("path",{d:"M11 12h1v4h1"})])],-1),d=n("p",{class:"custom-container-title"},"TIP",-1),k={href:"https://www.bilibili.com/video/BV1iJ411j7QY",target:"_blank",rel:"noopener noreferrer"},m=t(`<h1 id="_01【熟悉】fastdfs原理及入门" tabindex="-1"><a class="header-anchor" href="#_01【熟悉】fastdfs原理及入门" aria-hidden="true">#</a> 01【熟悉】FastDFS原理及入门</h1><h2 id="_1-fastdfs概述" tabindex="-1"><a class="header-anchor" href="#_1-fastdfs概述" aria-hidden="true">#</a> 1，FASTDFS概述</h2><p>FastDFS是一个开源的轻量级分布式文件系统，它对文件进行管理，功能包括：文件存储、文件同步、文件访问（文件上传、文件下载）等，解决了大容量存储和负载均衡的问题。特别适合以中小文件（建议范围：4KB &lt; file_size &lt;500MB），如相册网站、视频网站等等</p><p>FastDFS为互联网量身定制，充分考虑了冗余备份、负载均衡、线性扩容等机制，并注重高可用、高性能等指标，使用FastDFS很容易搭建一套高性能的文件服务器集群提供文件上传、下载等服务。</p><hr><h2 id="_2-系统结构图" tabindex="-1"><a class="header-anchor" href="#_2-系统结构图" aria-hidden="true">#</a> 2，系统结构图</h2><p><img src="https://picgo.xingenhi.cn//typora0.6966752854185582.png" alt="image"></p><ul><li>FastDFS分为Tracker、Storage，其中Storage负责存储文件，Tracker负责存储文件所在地址，主要作用是负载均衡和资源调度。</li><li>Tracker、Storage都可以实现集群部署，Tracker的每个节点地位平等，而Storage可以分为多个组，每个组之间保存的文件是不同的，组内部分为多个成员，每个成员保存的内容是一样，组成员地位一致，没有主从概念。</li><li>使用FastDFS存储文件优点：可以应对互联网的海量文件存储，一旦文件较多，可以随时横向扩展，且集群的实现也使系统不存在单点故障问题，用户不会因为服务器宕机而无法访问文件资源。</li></ul><hr><h2 id="_3-工作流程详解" tabindex="-1"><a class="header-anchor" href="#_3-工作流程详解" aria-hidden="true">#</a> 3，工作流程详解</h2><p>文件上传：Client会先向Tracker询问存储地址，Tracker查询到存储地址后返回给Client，Client拿着地址直接和对应的Storage通讯，将文件上传至改Storage。</p><p><img src="https://picgo.xingenhi.cn//typora0.3825610796307207.png" alt="image"></p><p>文件下载：同样，Client会向Tracker询问地址，并带上要查询的文件名和组名，Tracker查询后会将地址返回给Client，Client拿着地址和指定Storage通讯并下载文件。</p><p><img src="https://picgo.xingenhi.cn//typora0.9894144844018683.png" alt="image"></p><h1 id="_02【掌握】linux下的安装部署fastdfs" tabindex="-1"><a class="header-anchor" href="#_02【掌握】linux下的安装部署fastdfs" aria-hidden="true">#</a> 02【掌握】Linux下的安装部署fastdfs</h1><blockquote><p>安装fastDFS需要分别安装fastdfs-nginx-module，fastdfs，nginx，libfastcommon</p></blockquote><h2 id="_1-安装gcc-编译时需要" tabindex="-1"><a class="header-anchor" href="#_1-安装gcc-编译时需要" aria-hidden="true">#</a> 1，安装gcc(编译时需要)</h2><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>yum install -y gcc gcc-c++
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2，安装libevent(运行时需要)</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>yum -y install libevent
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><h2 id="_3-安装创建目录上传所有文件" tabindex="-1"><a class="header-anchor" href="#_3-安装创建目录上传所有文件" aria-hidden="true">#</a> 3，安装创建目录上传所有文件</h2><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>mkdir -p /fileservice/fast
cd /fileservice/fast
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://picgo.xingenhi.cn//typoradd970544-1a96-4d5e-8fe0-bdb07afd2fa8.png" alt="image"></p><h2 id="_4-安装libfastcommon" tabindex="-1"><a class="header-anchor" href="#_4-安装libfastcommon" aria-hidden="true">#</a> 4，安装libfastcommon</h2><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>进入fast目录：cd /fileservice/fast
解压文件： tar -zxvf libfastcommon-1.0.35.tar.gz
进入libfast文件目录：cd libfastcommon-1.0.35
执行编译：./make.sh
安装：./make.sh install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://picgo.xingenhi.cn//typoraa65930e9-db3a-42c1-8079-4297a5434b95.png" alt="image"></p><p>安装完成之后</p><p><img src="https://picgo.xingenhi.cn//typora6c18b8d4-e445-4080-a76c-154abc66c09e.png" alt="image"></p><h2 id="_5、安装fastdfs" tabindex="-1"><a class="header-anchor" href="#_5、安装fastdfs" aria-hidden="true">#</a> 5、安装fastdfs</h2><h3 id="_5-1-下载" tabindex="-1"><a class="header-anchor" href="#_5-1-下载" aria-hidden="true">#</a> 5.1，下载</h3>`,31),v={href:"https://sourceforge.net/projects/fastdfs/files/",target:"_blank",rel:"noopener noreferrer"},g=t(`<p>网官下载很慢，看我准备的安装文件</p><h3 id="_5-2-安装相关依赖库" tabindex="-1"><a class="header-anchor" href="#_5-2-安装相关依赖库" aria-hidden="true">#</a> 5.2，安装相关依赖库</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>yum install perl
yum install pcre
yum install pcre-devel
yum install zlib
yum install zlib-devel
yum install openssl
yum install openssl-devel
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-安装fastdfs" tabindex="-1"><a class="header-anchor" href="#_5-3-安装fastdfs" aria-hidden="true">#</a> 5.3，安装fastdfs</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>进入fast目录：cd /fileservice/fast
解压文件：tar -zxvf fastdfs-5.11.tar.gz
进入解压后的目录：cd fastdfs-5.11
执行编译：./make.sh
安装：./make.sh install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>成功之后</p><p><img src="https://picgo.xingenhi.cn//typorac37c70ac-49d5-42db-97a1-0417fed73e1f.png" alt="image"></p><p>5.4，查看tracker和storage的可执行脚本(后面有用)</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>ll /etc/init.d/ | grep fdfs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://picgo.xingenhi.cn//typora7e67b95c-bdc9-4be1-b06b-735998b87ce7.png" alt="image"></p><h3 id="_5-5-准备配置文件-默认在-etc-fdfs-下面" tabindex="-1"><a class="header-anchor" href="#_5-5-准备配置文件-默认在-etc-fdfs-下面" aria-hidden="true">#</a> 5.5，准备配置文件 默认在/etc/fdfs/下面</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>cd /etc/fdfs/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://picgo.xingenhi.cn//typoraf546e391-526b-43f9-92e3-32e647160973.png" alt="image"></p><p>先把配置文件名中的sample去了。[可以复制一份]</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>cp client.conf.sample client.conf
cp storage.conf.sample storage.conf
cp storage_ids.conf.sample storage_ids.conf
cp tracker.conf.sample tracker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://picgo.xingenhi.cn//typora6e8f4d82-ca29-43a0-97f2-9eae42192262.png" alt="image"></p><p>然后修改tracker的存放数据和日志的目录。</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>mkdir -p /home/leige/fastdfs/tracker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_6、配置和启动tracker" tabindex="-1"><a class="header-anchor" href="#_6、配置和启动tracker" aria-hidden="true">#</a> 6、配置和启动tracker</h2><h3 id="_6-1-切换目录到-etc-fdfs-目录下" tabindex="-1"><a class="header-anchor" href="#_6-1-切换目录到-etc-fdfs-目录下" aria-hidden="true">#</a> 6.1，切换目录到： /etc/fdfs/ 目录下；</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>cd /etc/fdfs/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_6-2-修改tracker-conf" tabindex="-1"><a class="header-anchor" href="#_6-2-修改tracker-conf" aria-hidden="true">#</a> 6.2，修改tracker.conf</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code> vim tracker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>base_path=/home/yuqing/fastdfs 改为: base_path=/home/leige/fastdfs/tracker</p><p><img src="https://picgo.xingenhi.cn//typorab6140e01-8f75-46c2-bf83-5f3f0ff4567e.png" alt="image"></p><h3 id="_6-3-启动tracker-运行如下命令" tabindex="-1"><a class="header-anchor" href="#_6-3-启动tracker-运行如下命令" aria-hidden="true">#</a> 6.3，启动tracker，运行如下命令：</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>service fdfs_trackerd  start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注意：在/home/leige/fastdfs/tracker 目录下生成两个目录， 一个是数据，一个是日志；</p><p><img src="https://picgo.xingenhi.cn//typora1b0d8817-bb30-4b51-ac47-6e68e4984862.png" alt="image"></p><h2 id="_7、配置和启动storage" tabindex="-1"><a class="header-anchor" href="#_7、配置和启动storage" aria-hidden="true">#</a> 7、配置和启动storage</h2><p>由于上面已经安装过FastDFS，这里只需要配置storage就好了；</p><h3 id="_7-1-切换目录到-etc-fdfs-目录下" tabindex="-1"><a class="header-anchor" href="#_7-1-切换目录到-etc-fdfs-目录下" aria-hidden="true">#</a> 7.1，切换目录到： /etc/fdfs/ 目录下；</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>cd /etc/fdfs/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_7-2-修改storage-conf-vim-storage-conf" tabindex="-1"><a class="header-anchor" href="#_7-2-修改storage-conf-vim-storage-conf" aria-hidden="true">#</a> 7.2，修改storage.conf ; vim storage.conf</h3><p>group_name=group1 #配置组名</p><p><img src="https://picgo.xingenhi.cn//typora30657286-3783-4448-8243-3e98978a82fe.png" alt="image"></p><p>base_path=/home/yuqing/fastdfs 改为: base_path=/home/leige/fastdfs/storage</p><p><img src="https://picgo.xingenhi.cn//typorafc09007a-0e9e-4450-8a51-a48f5600b43f.png" alt="image"></p><p>#store存放文件的位置(store_path)</p><p>store_path0=/home/yuqing/fastdfs 改为： store_path0=/home/leige/fastdfs/storage</p><p><img src="https://picgo.xingenhi.cn//typorabc17ebec-68b9-49f9-803a-f1445996f236.png" alt="image"></p><p>#如果有多个挂载磁盘则定义多个store_path，如下</p><p>#store_path1=.....</p><p>#store_path2=......</p><p>#配置tracker服务器:IP</p><p>tracker_server=117.48.203.125:22122</p><p><img src="https://picgo.xingenhi.cn//typoraaa329570-a8c4-4ab4-9456-25812d29dde1.png" alt="image"></p><p>#如果有多个则配置多个tracker</p><p>#tracker_server=117.48.203.126:22122</p><h3 id="_7-3-创建-home-leige-fastdfs-storage-目录" tabindex="-1"><a class="header-anchor" href="#_7-3-创建-home-leige-fastdfs-storage-目录" aria-hidden="true">#</a> 7.3，创建/home/leige/fastdfs/storage 目录</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>mkdir -p /home/leige/fastdfs/storage
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_7-4-启动storage-运行命令如下" tabindex="-1"><a class="header-anchor" href="#_7-4-启动storage-运行命令如下" aria-hidden="true">#</a> 7.4，启动storage， 运行命令如下：</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>service fdfs_storaged start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>启动完成后进入 /home/leige/fastdfs/storage/data 目录下，显示目录如下：</p><p><img src="https://picgo.xingenhi.cn//typoradf9cc4ff-82dc-4af6-8bfa-c92599f694f5.png" alt="image"></p><h2 id="_8、使用fastdfs自带工具测试" tabindex="-1"><a class="header-anchor" href="#_8、使用fastdfs自带工具测试" aria-hidden="true">#</a> 8、使用FastDFS自带工具测试</h2><h3 id="_8-1-切换目录到-etc-fdfs-目录下" tabindex="-1"><a class="header-anchor" href="#_8-1-切换目录到-etc-fdfs-目录下" aria-hidden="true">#</a> 8.1，切换目录到 /etc/fdfs/ 目录下；</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>cd /etc/fdfs/cd 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_8-2-修改client-conf-vim-client-conf" tabindex="-1"><a class="header-anchor" href="#_8-2-修改client-conf-vim-client-conf" aria-hidden="true">#</a> 8.2，修改client.conf ; vim client.conf，</h3><p>修改基本路径和tracker_server如下：</p><p><img src="https://picgo.xingenhi.cn//typorac4a98d55-9be2-4e0f-bf0b-1dde95e307c2.png" alt="image"></p><p>注意：若tracker有多个，可以配置多个，如下:</p><p>#tracker_server=......</p><p>#tracker_server=......</p><h3 id="_8-3-拷贝一张图片baobao-png到centos服务器上的-root-目录下" tabindex="-1"><a class="header-anchor" href="#_8-3-拷贝一张图片baobao-png到centos服务器上的-root-目录下" aria-hidden="true">#</a> 8.3，拷贝一张图片baobao.png到Centos服务器上的 /root/目录下；</h3><p><img src="https://picgo.xingenhi.cn//typoraa38238d7-16e8-424b-9948-ed1cd5bf6262.png" alt="image"></p><p>8.4,进行测试</p><p>运行如下（运行测试程序，读取/etc/fdfs/client.conf 文件，上传/root/目录下的baobao.png文件）</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>/usr/bin/fdfs_upload_file /etc/fdfs/client.conf /root/baobao.png 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>结果如下，表示搭建成功；</p><p><img src="https://picgo.xingenhi.cn//typora4f38f263-b9d8-4d8a-b17c-a573f911d79a.png" alt="image"></p><p>以上图中的文件地址：http://117.48.203.125/group1/M00/00/00/wKgAA135BdKAEOs1ADW668UZmDM218.png 对应storage服务器上的/home/leige/fastdfs/storage/data/00/00/wKgAA135BdKAEOs1ADW668UZmDM218.png文件；</p><p>由于现在还没有和nginx整合无法使用http下载。</p><h2 id="_9、fastdfs-和nginx整合" tabindex="-1"><a class="header-anchor" href="#_9、fastdfs-和nginx整合" aria-hidden="true">#</a> 9、FastDFS 和nginx整合</h2><h3 id="_9-1-在tracker上安装-nginx" tabindex="-1"><a class="header-anchor" href="#_9-1-在tracker上安装-nginx" aria-hidden="true">#</a> 9.1 在tracker上安装 nginx</h3><p>在每个tracker上安装nginx，的主要目的是做负载均衡及实现高可用。如果只有一台tracker可以不配置nginx。</p><p>一个tracker对应多个storage，通过nginx对storage负载均衡；</p><h3 id="_9-2-在storage-上安装nginx" tabindex="-1"><a class="header-anchor" href="#_9-2-在storage-上安装nginx" aria-hidden="true">#</a> 9.2 在storage 上安装nginx</h3><p>（1）上传fastdfs-nginx-module-1.20.tar.gz 到Centos服务器上；</p><p><img src="https://picgo.xingenhi.cn//typora4f98f75a-13da-4972-9708-f3704f087f32.png" alt="image"></p><p>（2）解压fastdfs-nginx-module-1.20.tar.gz 并移动到 /usr/local目录下；</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>tar -zxvf  fastdfs-nginx-module-1.20.tar.gz   解压
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（3）切换目录到： fastdfs-nginx-module-1.20/src 目录下</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>cd fastdfs-nginx-module-1.20/src
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（4）修改config文件，将文件中的所有 /usr/local/ 路径改为 /usr/</p><p>修改之后</p><p><img src="https://picgo.xingenhi.cn//typora978df0cf-03ed-4dae-9563-50db08070f21.png" alt="image"></p><p>（5）将fastdfs-nginx-module/src下的mod_fastdfs.conf拷贝至/etc/fdfs/下</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>cp mod_fastdfs.conf /etc/fdfs/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（6）并修改 /etc/fdfs/mod_fastdfs.conf 的内容；</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>vi /etc/fdfs/mod_fastdfs.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>tracker_server=117.48.203.125:22122</p><p><img src="https://picgo.xingenhi.cn//typora1cf1b508-4164-4c87-98bc-c735c1b35bf8.png" alt="image"></p><p>#tracker_server=192.168.172.20:22122 #(多个tracker配置多行)</p><p>url_have_group_name=true #url中包含group名称</p><p><img src="https://picgo.xingenhi.cn//typoraf2060897-2d47-49a3-8971-3ad0d6fed04f.png" alt="image"></p><p>store_path0=/home/fdfs_storage #指定文件存储路径（上面配置的store路径）</p><p><img src="https://picgo.xingenhi.cn//typoraf4df27de-de73-4857-9cb0-89e75e28d96f.png" alt="image"></p><h3 id="_9-3-进入之前解压的fastdfs目录下-把http-conf、mime-conf移动至-etc-fdfs" tabindex="-1"><a class="header-anchor" href="#_9-3-进入之前解压的fastdfs目录下-把http-conf、mime-conf移动至-etc-fdfs" aria-hidden="true">#</a> 9.3 进入之前解压的fastdfs目录下，把http.conf、mime.conf移动至/etc/fdfs</h3><p><img src="https://picgo.xingenhi.cn//typorab7885925-2599-44c7-a5a4-d613cfab0663.png" alt="image"></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>cp http.conf mime.types /etc/fdfs/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_10-nginx的安装" tabindex="-1"><a class="header-anchor" href="#_10-nginx的安装" aria-hidden="true">#</a> 10， Nginx的安装</h2><h3 id="_10-1-上传-nginx-1-15-2-tar-gz-到centos服务器上" tabindex="-1"><a class="header-anchor" href="#_10-1-上传-nginx-1-15-2-tar-gz-到centos服务器上" aria-hidden="true">#</a> 10.1，上传 nginx-1.15.2.tar.gz 到Centos服务器上；</h3><p><img src="https://picgo.xingenhi.cn//typora9810e200-b4cd-4157-ab37-b754494307c1.png" alt="image"></p><h3 id="_10-2-解压-nginx-1-15-2-tar-gz" tabindex="-1"><a class="header-anchor" href="#_10-2-解压-nginx-1-15-2-tar-gz" aria-hidden="true">#</a> 10.2，解压 nginx-1.15.2.tar.gz</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>cd /fileservice/fast/
tar -zxvf nginx-1.15.2.tar.gz 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-3-进入nginx解压的目录下" tabindex="-1"><a class="header-anchor" href="#_10-3-进入nginx解压的目录下" aria-hidden="true">#</a> 10.3，进入nginx解压的目录下</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>cd nginx-1.15.2/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_10-4-加入模块命令配置" tabindex="-1"><a class="header-anchor" href="#_10-4-加入模块命令配置" aria-hidden="true">#</a> 10.4，加入模块命令配置</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>./configure --prefix=/opt/nginx --sbin-path=/usr/bin/nginx --add-module=/fileservice/fast/fastdfs-nginx-module-1.20/src
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_10-5-编译并安装" tabindex="-1"><a class="header-anchor" href="#_10-5-编译并安装" aria-hidden="true">#</a> 10.5，编译并安装</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>make &amp;&amp; make install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_10-6-修改nginx配置" tabindex="-1"><a class="header-anchor" href="#_10-6-修改nginx配置" aria-hidden="true">#</a> 10.6，修改nginx配置</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>cd /opt/nginx/conf
vim nginx.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://picgo.xingenhi.cn//typora6a480799-3626-4851-9547-e408d864764b.png" alt="image"></p><h3 id="_10-7-启动nginx" tabindex="-1"><a class="header-anchor" href="#_10-7-启动nginx" aria-hidden="true">#</a> 10.7，启动nginx</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>cd /usr/bin/
./nginx   #启动
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_11、在浏览器中访问上传到fastdfs的图片" tabindex="-1"><a class="header-anchor" href="#_11、在浏览器中访问上传到fastdfs的图片" aria-hidden="true">#</a> 11、在浏览器中访问上传到fastDFS的图片</h2><p>因为Centos系统有防火墙，需要先关闭掉，才可以在浏览器中访问；</p><p>（1）CentOS 7.0默认使用的是firewall作为防火墙；若没有启用iptables 作为防火墙，则使用以下方式关闭防火墙：</p><p>systemctl stop firewalld.service #停止firewall</p><p>systemctl disable firewalld.service #禁止firewall开机启动</p><p>firewall-cmd --state #查看默认防火墙状态（关闭后显示notrunning，开启后显示running）</p><p>（2）若已经启用iptables作为防火墙，则使用以下方式关闭：</p><p>service iptables stop #临时关闭防火墙</p><p>chkconfig iptables off #永久关闭防火墙</p><p>（3）在谷歌浏览器中访问刚才上传的图片：</p>`,127),b={href:"http://117.48.203.125/group1/M00/00/00/wKgAA135BdKAEOs1ADW668UZmDM218.png",target:"_blank",rel:"noopener noreferrer"},h=t(`<p>宝宝镇楼，可爱不</p><p><img src="https://picgo.xingenhi.cn//typora60ea76a4-517f-423f-825e-55fac57b8bf7.jpg" alt="image"></p><h1 id="_03【掌握】使用docker搭建" tabindex="-1"><a class="header-anchor" href="#_03【掌握】使用docker搭建" aria-hidden="true">#</a> 03【掌握】使用Docker搭建</h1><h2 id="_1-拉取镜像并启动" tabindex="-1"><a class="header-anchor" href="#_1-拉取镜像并启动" aria-hidden="true">#</a> 1，拉取镜像并启动</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>docker run <span class="token operator">-</span>d <span class="token operator">--</span>restart<span class="token operator">=</span>always <span class="token operator">--</span>privileged<span class="token operator">=</span><span class="token boolean">true</span> <span class="token operator">--</span>net<span class="token operator">=</span>host <span class="token operator">--</span>name<span class="token operator">=</span>fastdfs <span class="token operator">-</span>e <span class="token constant">IP</span><span class="token operator">=</span><span class="token number">129.211</span><span class="token number">.39</span><span class="token number">.189</span> <span class="token operator">-</span>e <span class="token constant">WEB_PORT</span><span class="token operator">=</span><span class="token number">80</span> <span class="token operator">-</span>v $<span class="token punctuation">{</span><span class="token constant">HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>fastdfs<span class="token operator">:</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>local<span class="token operator">/</span>fdfs registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>beijing<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>tianzuo<span class="token operator">/</span>fastdfs

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>其中-v \${HOME}/fastdfs:/var/local/fdfs是指：将\${HOME}/fastdfs这个目录挂载到容器里的/var/local/fdfs这个目录里。所以上传的文件将被持久化到\${HOME}/fastdfs/storage/data里，IP 后面是自己的服务器公网ip或者虚拟机ip，-e WEB_PORT=80 指定nginx端口</p><h2 id="_2-测试上传" tabindex="-1"><a class="header-anchor" href="#_2-测试上传" aria-hidden="true">#</a> 2，测试上传</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//进入容器</span>
docker exec <span class="token operator">-</span>it fastdfs <span class="token operator">/</span>bin<span class="token operator">/</span>bash
<span class="token comment">//创建文件</span>
echo <span class="token string">&quot;Hello FastDFS!&quot;</span><span class="token operator">&gt;</span>index<span class="token punctuation">.</span>html
<span class="token comment">//测试文件上传</span>
fdfs_test <span class="token operator">/</span>etc<span class="token operator">/</span>fdfs<span class="token operator">/</span>client<span class="token punctuation">.</span>conf upload index<span class="token punctuation">.</span>html
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://picgo.xingenhi.cn//typora10b02321-15aa-4c9f-98e2-29602aa8678d.png" alt="image"></p><h2 id="_3-配置端口" tabindex="-1"><a class="header-anchor" href="#_3-配置端口" aria-hidden="true">#</a> 3，配置端口</h2><p><img src="https://picgo.xingenhi.cn//typora6714687e-0f63-4dab-ba3d-0874b62c924a.png" alt="image"></p><h2 id="_4-测试访问" tabindex="-1"><a class="header-anchor" href="#_4-测试访问" aria-hidden="true">#</a> 4，测试访问</h2>`,12),f={href:"http://192.168.149.128/group1/M00/00/00/wKiVgF3dfV6ANGAyAAAADwL5vO455_big.html",target:"_blank",rel:"noopener noreferrer"},x=t(`<p><img src="https://picgo.xingenhi.cn//typora590e7d6b-2aec-43be-8e82-47bed60219e8.png" alt="image"></p><h1 id="_04【掌握】使用java代码-测试上传" tabindex="-1"><a class="header-anchor" href="#_04【掌握】使用java代码-测试上传" aria-hidden="true">#</a> 04【掌握】使用Java代码 测试上传</h1><h2 id="_1-创建java项目" tabindex="-1"><a class="header-anchor" href="#_1-创建java项目" aria-hidden="true">#</a> 1，创建java项目</h2><p><img src="https://picgo.xingenhi.cn//typora658532be-cc36-4e39-be17-fb2d733f61ab.jpg" alt="image"></p><h2 id="_2-加入依赖" tabindex="-1"><a class="header-anchor" href="#_2-加入依赖" aria-hidden="true">#</a> 2，加入依赖</h2><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.oschina.zcx7878<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastdfs-client-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.27.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- spring-core --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.3.25.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_3-创建fdfs-client-conf客户端配置文件" tabindex="-1"><a class="header-anchor" href="#_3-创建fdfs-client-conf客户端配置文件" aria-hidden="true">#</a> <strong>3，创建fdfs_client.conf客户端配置文件</strong></h2><p><img src="https://picgo.xingenhi.cn//typora40978460-0133-4362-9259-681fc4dd5068.png" alt="image"></p><div class="language-perl line-numbers-mode" data-ext="perl"><pre class="language-perl"><code>connect_timeout<span class="token operator">=</span><span class="token number">30</span>

network_timeout<span class="token operator">=</span><span class="token number">60</span>

base_path<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>fastdfs

<span class="token comment">#改为自己服务器的ip</span>
tracker_server<span class="token operator">=</span><span class="token v-string string">192.168.149.128</span><span class="token punctuation">:</span><span class="token number">22122</span>

log_level<span class="token operator">=</span>info

use_connection_pool <span class="token operator">=</span> false

connection_pool_max_idle_time <span class="token operator">=</span> <span class="token number">3600</span>

load_fdfs_parameters_from_tracker<span class="token operator">=</span>false

use_storage_id <span class="token operator">=</span> false

storage_ids_filename <span class="token operator">=</span> storage_ids<span class="token operator">.</span>conf

http<span class="token operator">.</span>tracker_server_port<span class="token operator">=</span><span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-测试类" tabindex="-1"><a class="header-anchor" href="#_4-测试类" aria-hidden="true">#</a> <strong>4，测试类</strong></h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">*</span><span class="token operator">*</span>
 <span class="token operator">*</span> <span class="token annotation punctuation">@Author</span> 雷哥
 <span class="token operator">*</span> <span class="token annotation punctuation">@Description</span> <span class="token comment">//TODO</span>
 <span class="token operator">*</span> <span class="token annotation punctuation">@Date</span> $ $
 <span class="token operator">*</span> <span class="token annotation punctuation">@Param</span> $
 <span class="token operator">*</span> <span class="token annotation punctuation">@return</span> $
 <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFastDFS</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> filePath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;fdfs_client.conf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1、加载配置文件，配置文件中的内容就是 tracker 服务的地址。</span>
        <span class="token class-name">ClientGlobal</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2、创建一个 TrackerClient 对象。直接 new 一个。</span>
        <span class="token class-name">TrackerClient</span> trackerClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrackerClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3、使用 TrackerClient 对象创建连接，获得一个 TrackerServer 对象。</span>
        <span class="token class-name">TrackerServer</span> trackerServer <span class="token operator">=</span> trackerClient<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4、创建一个 StorageServer 的引用，值为 null</span>
        <span class="token class-name">StorageServer</span> storageServer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// 5、创建一个 StorageClient 对象，需要两个参数 TrackerServer 对象、StorageServer 的引用</span>
        <span class="token class-name">StorageClient</span> storageClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StorageClient</span><span class="token punctuation">(</span>trackerServer<span class="token punctuation">,</span> storageServer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 6、使用 StorageClient 对象上传图片。</span>
        <span class="token comment">//扩展名不带“.”</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> strings <span class="token operator">=</span> storageClient<span class="token punctuation">.</span><span class="token function">upload_file</span><span class="token punctuation">(</span><span class="token string">&quot;C:/Users/LJH/Pictures/Camera Roll/bj1.jpg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jpg&quot;</span><span class="token punctuation">,</span>
                <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 7、返回数组。包含组名和图片的路径。</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> string <span class="token operator">:</span> strings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;上传完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://picgo.xingenhi.cn//typora23e5aa4a-961f-4b5f-b785-3836545bfa93.jpg" alt="image"></p><h1 id="_05【掌握】使用springboot完成文件上传1" tabindex="-1"><a class="header-anchor" href="#_05【掌握】使用springboot完成文件上传1" aria-hidden="true">#</a> 05【掌握】使用springboot完成文件上传1</h1><h2 id="_1-创建springboot-web项目" tabindex="-1"><a class="header-anchor" href="#_1-创建springboot-web项目" aria-hidden="true">#</a> 1，创建springboot web项目</h2><p><img src="https://picgo.xingenhi.cn//typora09576ecf-145a-4196-9ea0-9ef35e452d54.jpg" alt="image"></p><h2 id="_2-修改pom-xml加入依赖" tabindex="-1"><a class="header-anchor" href="#_2-修改pom-xml加入依赖" aria-hidden="true">#</a> 2，修改pom.xml加入依赖</h2><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.oschina.zcx7878<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastdfs-client-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.27.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-lang3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-修改yml" tabindex="-1"><a class="header-anchor" href="#_3-修改yml" aria-hidden="true">#</a> 3，修改yml</h2><div class="language-lisp line-numbers-mode" data-ext="lisp"><pre class="language-lisp"><code>fastdfs:
  connect_timeout_in_seconds: <span class="token number">30</span>
  network_timeout_in_seconds: <span class="token number">60</span>
  charset: UTF-8
  tracker_servers: 117.48.203.125:22122 #多个 trackerServer中间以逗号分隔
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-创建文件上传工具类" tabindex="-1"><a class="header-anchor" href="#_4-创建文件上传工具类" aria-hidden="true">#</a> 4，创建文件上传工具类</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * @Author 雷哥
 * @Description //TODO
 * @Date $ $
 * @Param $
 * <span class="token keyword">@return</span> $
 **/</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadService</span><span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${fastdfs.tracker_servers}&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> tracker_servers<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${fastdfs.connect_timeout_in_seconds}&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> connect_timeout<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${fastdfs.network_timeout_in_seconds}&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> network_timeout<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${fastdfs.charset}&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> charset<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> multipartFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>multipartFile <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;文件不能为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 上传至fastDFS, 返回文件id</span>
            <span class="token class-name">String</span> fileId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fdfsUpload</span><span class="token punctuation">(</span>multipartFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>fileId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;上传失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">throw</span>  <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;上传失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;上传成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;fileId&quot;</span><span class="token punctuation">,</span>fileId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> map<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token doc-comment comment">/**
         * 上传至fastDFS
         * <span class="token keyword">@param</span> <span class="token parameter">multipartFile</span>
         * <span class="token keyword">@return</span> 文件id
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">fdfsUpload</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> multipartFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 1. 初始化fastDFS的环境</span>
            <span class="token function">initFdfsConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 2. 获取trackerClient服务</span>
            <span class="token class-name">TrackerClient</span> trackerClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrackerClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">TrackerServer</span> trackerServer <span class="token operator">=</span> trackerClient<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 3. 获取storage服务</span>
                <span class="token class-name">StorageServer</span> storeStorage <span class="token operator">=</span> trackerClient<span class="token punctuation">.</span><span class="token function">getStoreStorage</span><span class="token punctuation">(</span>trackerServer<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 4. 获取storageClient</span>
                <span class="token class-name">StorageClient1</span> storageClient1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StorageClient1</span><span class="token punctuation">(</span>trackerServer<span class="token punctuation">,</span> storeStorage<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 5. 上传文件 (文件字节, 文件扩展名, )</span>
                <span class="token comment">// 5.1 获取文件扩展名</span>
                <span class="token class-name">String</span> originalFilename <span class="token operator">=</span> multipartFile<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> extName <span class="token operator">=</span> originalFilename<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>originalFilename<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 5.2 上传</span>
                <span class="token class-name">String</span> fileId <span class="token operator">=</span> storageClient1<span class="token punctuation">.</span><span class="token function">upload_file1</span><span class="token punctuation">(</span>multipartFile<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> extName<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> fileId<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token doc-comment comment">/**
         * 初始化fastDFS的环境
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initFdfsConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">ClientGlobal</span><span class="token punctuation">.</span><span class="token function">initByTrackers</span><span class="token punctuation">(</span>tracker_servers<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">ClientGlobal</span><span class="token punctuation">.</span><span class="token function">setG_connect_timeout</span><span class="token punctuation">(</span>connect_timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">ClientGlobal</span><span class="token punctuation">.</span><span class="token function">setG_network_timeout</span><span class="token punctuation">(</span>network_timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">ClientGlobal</span><span class="token punctuation">.</span><span class="token function">setG_charset</span><span class="token punctuation">(</span>charset<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-创建index-html页面测试" tabindex="-1"><a class="header-anchor" href="#_5-创建index-html页面测试" aria-hidden="true">#</a> 5，创建index.html页面测试</h2><div class="language-Plain line-numbers-mode" data-ext="Plain"><pre class="language-Plain"><code>&lt;body&gt;

&lt;form action=&quot;/upload/doUpload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
    &lt;input type=&quot;file&quot; name=&quot;mf&quot; /&gt;
    &lt;input type=&quot;submit&quot; value=&quot;上传&quot; /&gt;
&lt;/form&gt;
&lt;/body&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://picgo.xingenhi.cn//typora8577de84-893a-4c9a-8587-c200e8f095d1.png" alt="image"></p><h1 id="_06【掌握】使用springboot完成文件上传2" tabindex="-1"><a class="header-anchor" href="#_06【掌握】使用springboot完成文件上传2" aria-hidden="true">#</a> 06【掌握】使用springboot完成文件上传2</h1><h2 id="_1-创建项目加入依赖" tabindex="-1"><a class="header-anchor" href="#_1-创建项目加入依赖" aria-hidden="true">#</a> 1，创建项目加入依赖</h2><div class="language-Plain line-numbers-mode" data-ext="Plain"><pre class="language-Plain"><code>&lt;!-- https://mvnrepository.com/artifact/com.github.tobato/fastdfs-client --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.github.tobato&lt;/groupId&gt;
    &lt;artifactId&gt;fastdfs-client&lt;/artifactId&gt;
    &lt;version&gt;1.26.7&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-修改yml" tabindex="-1"><a class="header-anchor" href="#_2-修改yml" aria-hidden="true">#</a> 2，修改yml</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>fdfs<span class="token operator">:</span>
  so<span class="token operator">-</span>timeout<span class="token operator">:</span> <span class="token number">2500</span>       # 读取时间
  connect<span class="token operator">-</span>timeout<span class="token operator">:</span> <span class="token number">600</span>   # 连接超时时间
  thumb<span class="token operator">-</span>image<span class="token operator">:</span>           # 缩略图
    width<span class="token operator">:</span> <span class="token number">100</span>
    height<span class="token operator">:</span> <span class="token number">100</span>
  tracker<span class="token operator">-</span>list<span class="token operator">:</span>          # tracker服务配置地址列表
    <span class="token operator">-</span> <span class="token number">117.48</span><span class="token number">.203</span><span class="token number">.125</span><span class="token operator">:</span><span class="token number">22122</span>
upload<span class="token operator">:</span>
    base<span class="token operator">-</span>url<span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">117.48</span><span class="token number">.203</span><span class="token number">.125</span><span class="token operator">/</span>
    allow<span class="token operator">-</span>types<span class="token operator">:</span>
      <span class="token operator">-</span> image<span class="token operator">/</span>jpeg
      <span class="token operator">-</span> image<span class="token operator">/</span>png
      <span class="token operator">-</span> image<span class="token operator">/</span>bmp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注入FastFileStorageClient后，可以直接调用其uploadFile()，比上一种方法省去了手动设置配置信息，也不需要自己建立tracker连接、获取storage、再获得storageClient这些准备工作。</p><h2 id="_3-创建配置属性类" tabindex="-1"><a class="header-anchor" href="#_3-创建配置属性类" aria-hidden="true">#</a> 3，创建配置属性类</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;upload&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadProperties</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> baseUrl<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> allowTypes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-创建服务类" tabindex="-1"><a class="header-anchor" href="#_4-创建服务类" aria-hidden="true">#</a> 4，创建服务类</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">UploadProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadService</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token class-name">Log</span> log<span class="token operator">=</span> <span class="token class-name">LogFactory</span><span class="token punctuation">.</span><span class="token function">getLog</span><span class="token punctuation">(</span><span class="token class-name">UploadService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Autowired</span>
        <span class="token keyword">private</span> <span class="token class-name">FastFileStorageClient</span> storageClient<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Autowired</span>
        <span class="token keyword">private</span> <span class="token class-name">UploadProperties</span> prop<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">uploadImage</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 1、校验文件类型</span>
            <span class="token class-name">String</span> contentType <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>prop<span class="token punctuation">.</span><span class="token function">getAllowTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>contentType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;文件类型不支持&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 2、校验文件内容</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">BufferedImage</span> image <span class="token operator">=</span> <span class="token class-name">ImageIO</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>image <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> image<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> image<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;上传文件有问题&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;校验文件内容失败....{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;校验文件内容失败&quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// 3、上传到FastDFS</span>
                <span class="token comment">// 3.1、获取扩展名</span>
                <span class="token class-name">String</span> extension <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">substringAfterLast</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 3.2、上传</span>
                <span class="token class-name">StorePath</span> storePath <span class="token operator">=</span> storageClient<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> extension<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 返回路径</span>
                <span class="token keyword">return</span> prop<span class="token punctuation">.</span><span class="token function">getBaseUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> storePath<span class="token punctuation">.</span><span class="token function">getFullPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;【文件上传】上传文件失败！....{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">throw</span>  <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;【文件上传】上传文件失败！&quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-创建uploadcontroller" tabindex="-1"><a class="header-anchor" href="#_5-创建uploadcontroller" aria-hidden="true">#</a> 5，创建UploadController</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;upload&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadController</span> <span class="token punctuation">{</span>

   <span class="token annotation punctuation">@Autowired</span>
   <span class="token keyword">private</span> <span class="token class-name">UploadService</span> uploadService<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;doUpload&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">doUpload</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> mf<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mf<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> upload <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>uploadService<span class="token punctuation">.</span><span class="token function">uploadImage</span><span class="token punctuation">(</span>mf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        upload<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> upload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="fastdfs在springboot中的使用" tabindex="-1"><a class="header-anchor" href="#fastdfs在springboot中的使用" aria-hidden="true">#</a> FastDFS在springboot中的使用</h1><p>pom.xml依赖加入：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.oschina.zcx7878<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastdfs-client-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.27.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-lang3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- https://mvnrepository.com/artifact/com.github.tobato/fastdfs-client --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.tobato<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastdfs-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.26.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>yml配置：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>#  fastdfs设置
fdfs:
  so-timeout: 2500       # 读取时间
  connect-timeout: 600   # 连接超时时间
  thumb-image:           # 缩略图
    width: 100
    height: 100
  tracker-list:          # tracker服务配置地址列表
    - 129.211.39.189:22122
upload:
  base-url: 129.211.39.189/
  allow-types:
    - image/jpeg
    - image/png
    - image/bmp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,42);function _(y,w){const s=c("ExternalLinkIcon");return i(),o("div",null,[n("div",r,[u,d,n("p",null,[n("a",k,[a("课程视频"),e(s)])])]),m,n("p",null,[n("a",v,[a("https://sourceforge.net/projects/fastdfs/files/"),e(s)])]),g,n("p",null,[a("刚才上传的图片地址为："),n("a",b,[a("http://117.48.203.125/group1/M00/00/00/wKgAA135BdKAEOs1ADW668UZmDM218.png"),e(s)])]),h,n("p",null,[n("a",f,[a("http://192.168.149.128/group1/M00/00/00/wKiVgF3dfV6ANGAyAAAADwL5vO455_big.html"),e(s)])]),x])}const q=p(l,[["render",_],["__file","FastDFS.html.vue"]]);export{q as default};
